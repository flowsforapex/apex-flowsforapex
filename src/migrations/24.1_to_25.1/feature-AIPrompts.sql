/* 
-- Flows for APEX - create_24.1_ee_ddl.sql
-- 
-- (c) Copyright Flowquest Limited and / or its affiliates, 2024.
--
-- Created   12-Oct-24 Richard Allen,  Flowquest Limited
*/

-- Installs table added to 24.1 ee so that 25.1 ce and ee have same schema

-- check if flow_ai_prompts table already exists.  If not, create it...
declare
  v_table_exists number := 0;  
begin
  select count(*) 
    into v_table_exists
    from user_tables
   where upper(table_name) = 'FLOW_AI_PROMPTS';

  if (v_table_exists = 0) then
      execute immediate 'create table flow_ai_prompts
        ( aipr_id                     number generated by default as identity ( start with 1 nocache order )
                                  not null
        , aipr_prompt_key             varchar2(  50 char) not null
        , aipr_lang                   varchar2(  10 char) not null
        , aipr_provider_type_code     varchar2(  20 char)
        , aipr_model_name             varchar2(1000 char)
        , aipr_type                   varchar2(  20 char) not null
        , aipr_title                  varchar2(  50 char)
        , aipr_prompt_text            varchar2(4000 char)
        , aipr_display_as_qa          varchar2(   1 char)
        )';
      execute immediate 'alter table flow_ai_prompts
        add constraint flow_aipr_pk primary key ( aipr_id )';
      execute immediate 'alter table flow_aipr_uk unique ( aipr_prompt_key
                                                         , aipr_lang
                                                         , aipr_provider_type_code
                                                         , aipr_model_name
                                                         )';
  end if;
end;
/ 







create table flow_ai_prompts
( aipr_id                     number generated by default as identity ( start with 1 nocache order )
                              not null
, aipr_prompt_key             varchar2(  50 char) not null
, aipr_lang                   varchar2(  10 char) not null
, aipr_provider_type_code     varchar2(  20 char)
, aipr_model_name             varchar2(1000 char)
, aipr_type                   varchar2(  20 char) not null
, aipr_title                  varchar2(  50 char)
, aipr_prompt_text            varchar2(4000 char)
, aipr_display_as_qa          varchar2(   1 char)
);

alter table flow_ai_prompts
  add constraint flow_aipr_pk primary key ( aipr_id );

alter table flow_ai_prompts 
  add constraint flow_aipr_uk unique  ( aipr_prompt_key
                                      , aipr_lang
                                      , aipr_provider_type_code
                                      , aipr_model_name
                                      );
